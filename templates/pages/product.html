{% extends "base.html" %}
{% load order_tags %}

{% block page %}
	{% block content %}
    <ul class="nav nav-tabs" style="border: none;">
      <li class="nav-item">
        <a class="nav-link active" href="#" style="border: none;">Каталог</a>
      </li>
    </ul>

    <div class="container-fluid">
      <div class="row">
        <header class="col-md-3">
          <div class="btn-group goods-btn-group" role="group">
            <button id="Brend" type="button" class="btn btn-success goods-btn">Бренд</button>
            <button id="Assortment" type="button" class="btn btn-outline-warning goods-btn">Ассортимент</button>
          </div>
          <div id="brend-group" class="goods-menu-blocks" style="display: block;">
            <ul class="list-group">
              {% for brand in brands %}
              <li class="list-group-item">
                <input class="form-check-input me-1 switch-change" type="checkbox" value="brand" id="{{ brand.id }}" checked>
                <label class="form-check-label" for="{{ brand.id }}">{{ brand.name }}</label>
              </li>
              {% endfor %}
            </ul>
          </div>
          <div id="collection-group" class="goods-menu-blocks" style="display: none;">
            <ul class="list-group">
              {% for collection in collections %}
              <li class="list-group-item">
                <input class="form-check-input me-1 switch-change" type="checkbox" value="collection" id="{{ collection.id }}" checked>
                <label class="form-check-label" for="{{ collection.id }}">{{ collection.name }}</label>
              </li>
              {% endfor %}
            </ul>
          </div>
          <div class="goods-menu-blocks"></div>
          <div id="actions-group" class="goods-menu-blocks">
            <ul class="list-group">
              <li class="list-group-item">
                <a href="{% url 'orders:products' %}">Уцененные товары</a>
              </li>
              <li class="list-group-item">
                <a href="{% url 'orders:сertificates' %}">Подарочные сертификаты</a>
              </li>
              <li class="list-group-item">
                <a href="{% url 'orders:services' %}">Услуги</a>
              </li>
            </ul>
          </div>
        </header>

        <div style="display:none">
          <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
        </div>

        <main id="products" class="col-md-9 products">
          {% for product in products %}
            {% with price=prices|get_item:product.id %}
            <div class="good-block position-relative">
              <div class="row good-row">
                <div class="col-xs-1 col-md-2 col-md-3 col-lg-4 col-center">
                  {% for image in product.get_images|slice:":1" %}
                    <figure>
                      <img 
                        src="{{ image }}"
                        class="img-fluid rounded img-thumbnail thumbnail-150"
                        alt="{{ product.name }}"
                        style="border: none;"
                      >
                    </figure>
                  {% endfor %}
                </div>
                <div class="col-xs-1 col-sm-3 col-md-3 col-lg-4 col-center">
                  <div class="row px-4 px-sm-0">
                    <a href="{% url 'orders:product' product.id %}" class="stretched-link">Карточка товара</a>
                  </div>
                  <div class="row px-4 px-sm-0">
                    <div><b>{{ product.name }}</b></div>
                  </div>
                  <div class="row px-4 px-sm-0">
                    <div>Артикул: {{ product.articul }}</div>
                  </div>
                </div>
                <div class="col-xs-1 col-sm-3 col-md-3 col-lg-4 col-center">
                  <div class="row px-4 px-sm-0">
                    <form id="cartForm-{{product.id}}" method="post" action="{% url 'cart:cart_add' product.id %}">
                      {% csrf_token %}
                      <input type="hidden" name="quantity" value="1" />
                      <input type="hidden" name="update" value="False" />
                      {% if price %}
                        <input type="hidden" name="price" value="{{ price.actual_price }}" />
                        <input type="hidden" name="unit" value="{{ price.unit }}" />
                      {% else %}
                        <input type="hidden" name="price" value="0" />
                        <input type="hidden" name="unit" value="796" />                      
                      {% endif %}
                    </form>
                    <a href="#" onclick="document.getElementById('cartForm-{{product.id}}').submit();">в Корзину</a>
                  </div>
                  {% if price %}
                      <div class="row px-4 px-sm-0">
                        <div>Цена: {{ price.actual_price }} руб.</div>
                      </div>
                      <div class="row px-4 px-sm-0">
                        <div>В наличии: {{ product.stock }} {{ price.unit }}</div>
                      </div>
                  {% else %}
                    <div class="row px-4 px-sm-0">
                      <div>Цена: -- </div>
                    </div>
                    <div class="row px-4 px-sm-0">
                      <div>В наличии: -- </div>
                    </div>
                  {% endif %} 
                </div>
              </div>
            </div>
          {% endwith %}
          {% endfor %}
          
          <nav aria-label="Pagination">
            <ul class="pagination justify-content-end">
              {% if page_obj.has_previous %}
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}" tabindex="-1">Предыдущая</a>
              {% endif %}
              {% for page_number in paginator.page_range %}
                {% if page_obj.number == page_number %}
                  <li class="page-item page-item-selected"><a class="page-link" href="?page={{ page_number }}">{{ page_number }}</a></li>
                {% elif page_number >= page_obj.number|add:-2 and page_number <= page_obj.number|add:2  %}
                  <li class="page-item"><a class="page-link" href="?page={{ page_number }}">{{ page_number }}</a></li>
                {% endif %}
              {% endfor %}
              {% if page_obj.has_next %}
                <a class="page-link" href="?page={{ page_obj.next_page_number }}" tabindex="-1">Следующая</a>
              {% endif %}
            </ul>
          </nav>

        </main>

      </div>
    </div>

	{% endblock %}
{% endblock %}
